<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Leave Application</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .mic-icon {
            cursor: pointer;
            width: 32px;
            height: 32px;
        }
        .mic-icon:hover {
            opacity: 0.8;
        }
        .listening-icon {
            display: none;
            width: 32px;
            height: 32px;
        }
        .output {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
            color: #555;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 20px 0;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .response {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            Voice Leave Application
          
            <img id="start-voice" class="mic-icon" src="./microphone-342.png" alt="Microphone Icon">
            <img id="listening-icon" class="listening-icon" src="./headphones-5796.png" alt="Listening Icon">
        </h1>
        <div>
            <label><strong>Leave Type:</strong></label>
            <input type="text" id="leave-type" class="output" placeholder="Leave Type" readonly>
        </div>
        <div>
            <label><strong>From Date (YYYY-MM-DD):</strong></label>
            <input type="text" id="from-date-combined" class="output" placeholder="From Date" readonly>
        </div>
        <div>
            <label><strong>To Date (YYYY-MM-DD):</strong></label>
            <input type="text" id="to-date-combined" class="output" placeholder="To Date" readonly>
        </div>
        <button id="submit-leave">Submit Leave</button>
        <div id="response" class="response"></div>
    </div>

    <script>
        const leaveTypeElement = document.getElementById("leave-type");
        const fromDateCombinedElement = document.getElementById("from-date-combined");
        const toDateCombinedElement = document.getElementById("to-date-combined");
        const responseElement = document.getElementById("response");
        const micIcon = document.getElementById("start-voice");
        const listeningIcon = document.getElementById("listening-icon");

        let leaveType = "";
        let fromDate = "";
        let toDate = "";

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "en-US";
        recognition.interimResults = false;

        micIcon.addEventListener("click", () => {
            listeningIcon.style.display = "inline";
            micIcon.style.display = "none";
            responseElement.textContent = "Listening for voice input...";
            recognition.start();
        });

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.toLowerCase();
            responseElement.textContent = `You said: "${transcript}"`;

            const leaveTypeRegex = /(sick|vacation|casual|emergency)/i;
            const dateRegex = /\b(\d{1,2})\s*(january|february|march|april|may|june|july|august|september|october|november|december)\s*(\d{4})\b/g;

            const leaveTypeMatch = transcript.match(leaveTypeRegex);
            if (leaveTypeMatch) {
                leaveType = leaveTypeMatch[0].trim();
                leaveTypeElement.value = leaveType;
            }

            const dateMatches = [...transcript.matchAll(dateRegex)];
            if (dateMatches.length >= 2) {
                const months = {
                    january: "01", february: "02", march: "03", april: "04",
                    may: "05", june: "06", july: "07", august: "08",
                    september: "09", october: "10", november: "11", december: "12"
                };

                const fromDay = dateMatches[0][1].padStart(2, "0");
                const fromMonth = months[dateMatches[0][2].toLowerCase()];
                const fromYear = dateMatches[0][3];
                fromDate = `${fromYear}-${fromMonth}-${fromDay}`;
                fromDateCombinedElement.value = fromDate;

                const toDay = dateMatches[1][1].padStart(2, "0");
                const toMonth = months[dateMatches[1][2].toLowerCase()];
                const toYear = dateMatches[1][3];
                toDate = `${toYear}-${toMonth}-${toDay}`;
                toDateCombinedElement.value = toDate;
            } else {
                responseElement.textContent = "Please mention both From Date and To Date.";
            }

            listeningIcon.style.display = "none";
            micIcon.style.display = "inline";
        };

        recognition.onerror = (event) => {
            responseElement.textContent = `Error: ${event.error}`;
            listeningIcon.style.display = "none";
            micIcon.style.display = "inline";
        };

        document.getElementById("submit-leave").addEventListener("click", async () => {
            if (!leaveType || !fromDate || !toDate) {
                responseElement.textContent = "Please specify all fields: leave type, from date, and to date.";
                return;
            }

            const data = {
                employee_name: "Mr", 
                leave_type: leaveType,
                from_date: fromDate,
                to_date: toDate
            };

            try {
                const response = await fetch("http://127.0.0.1:5000/apply_leave", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    responseElement.textContent = result.message; // Success message
                } else {
                    const error = await response.json();
                    responseElement.textContent = `Error: ${error.detail}`;  // Error details
                }
            } catch (error) {
                responseElement.textContent = `Error applying leave: ${error.message}`;  // Network error
            }
        });
    </script>
</body>
</html>
